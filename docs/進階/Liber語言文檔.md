# Liber語言文檔

Liber語言，全稱「Liber是世界上最好的語言」，是Librian使用的劇本語言。

## 語法樣例

這裏列舉了所有的語法樣例。如果你想知道他們的表達式，也可以看liber-language的代碼。

+ 旁白
:   `潘大爺來了！`
+ 人物對話
:   `潘大爺 (笑)「你好啊！」`
+ 人物表情
:   `潘大爺 (笑)`
+ 人物操作
:   `@潘大爺 + 西裝`
+ 函數調用
:   `> BG 魔王城內`
+ 插入代碼
: 
            ```
            print('你好啊！')
            ```
+ 插入圖
:   `===第一章.png`
+ 鏡頭
:   `+ {潘大爺: [100, 120, 1.5]}`
+ 選項
:   `? 接受治療 -> 壞結局.liber`
+ 註釋
:   `# 我覺得這段劇本還要修改。`
+ 躍點
:   `*原點`

## 基本規則

大部分情況下Liber語言是按行解析的，換行即爲語句的終結。

預處理時，劇本被按行分割，但是人物對話和嵌入代碼段在文本中可能超過一行，因此它們會續行而不會被分割。

之後，編譯器將所有行使用各個正則表達式匹配，分別得到它們的類型和參數，包裝成dict，交給Librian虛擬機解釋。

## 停滯點

停滯點是一個重要的概念。

當Librian虛擬機解析到劇本中的停滯點的時候，就會向前端發送一組狀態數據以更新畫面，之後需要點擊一下鼠標來繼續。

在語法上，只有 `旁白` 、 `人物對話` 、 `插入圖` 、 `選項` 是停滯點。

### 樣例

```liber
> BG 黑
> BG 白
> BG 黑
潘大爺 「我好暈啊。」
```

這是一個錯誤樣例，原本想要實現的是背景圖片發生「黑-白-黑」的過渡，然後 `潘大爺` 說他很暈。

但是實際上這並不能實現，背景總是黑色的。  
這是因爲這段劇本中只有 `人物對話` 一個停滯點，而之前三次調用 `BG` 沒有傳送到前端就互相覆蓋了。

<small>正確的做法應該是使用CSS動畫來實現……</small>

### 與嵌入代碼的相互作用

嵌入代碼並不是一個停滯點，但是也會有停滯的現象。

`goto` 和 `call` 不會引發停滯，只有跳轉到目標劇本並到達下一個停滯點纔會停滯。因此如果你在副線程調用它，前端並不會變化。

`choice` 會引發停滯。在運行完一段嵌入的代碼時，如果有未處理的選項，爲了阻止讀取選項之後的內容，會發生停滯。

### 注意和例外

即使在函數調用中播放了視頻，也不會停滯。這是因爲視頻實際上是和下一句同時發送到前端的，只是前端把他們錯開了。

當多個選項同時出現時，只有最後一個是停滯點。
