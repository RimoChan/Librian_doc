# 劇本功能

這個章節將會介紹如何使用控制劇本演出的功能。

## 功能表

+ **BG**   
    更換 <ruby>背景圖片<rt>BG</rt></ruby>
+ **BGM**    
    更換 <ruby>背景音樂<rt>BGM</rt></ruby>
+ **CG**   
    顯示或消除CG   
+ **EF**    
    爲畫面元素添加 <ruby>特效<rt>effect</rt></ruby>
+ **VIDEO**    
    播放一段 <ruby>視頻<rt>video</rt></ruby>
+ **py/endpy**    
    插入一段python代碼
+ **js/endjs**   
    插入一段javascript代碼
+ **WRAP**   
    快速控制選項和跳轉

## 詳細介紹

先說一下，用豎線分割的漢字是爲「看到英文就頭大的開發者」提供的中文寫法，效果和英文完全一樣。  

然後，語法欄目裏，大括號 `{}` 裏面的是參數。如果參數帶等號 `=`，說明參數有默認值，也就是你不填這個參數就會使用 `=` 後面的值。

### BG | 背景

`BG` 會更換當前的<ruby>背景圖片<rt>BG</rt></ruby>爲你指定的文件。   
<small>(當然你得在圖片文件夾裏把圖片放好)</small>

+ 語法:
```    
    > BG {文件名}
```
+ 樣例:
```
    > BG 魔王城內
    > 背景 染紅的街道.png
```

> <ruby>背景圖片<rt>BG</rt></ruby>總是在一點時間內漸變的。
>
> 如果不指定擴展名，則會按 `'webp', 'png', 'jpg'` 的順序挑選存在文件的擴展名。
>
> <ruby>背景圖片<rt>BG</rt></ruby>文件不存在的場合，背景會變成黑色，控制檯會出現警告。

### BGM | 背景音樂 | 背景音乐
`BGM` 會更換當前的<ruby>背景音樂<rt>BGM</rt></ruby>爲你指定的文件。

如果指定爲 `None`，<ruby>背景音樂<rt>BGM</rt></ruby>會消除，會有一點淡出時間。但總是沒有淡入。   

+ 語法:
```    
    > BGM {文件名} {音量=1}
```
+ 樣例:
```
    > BGM 愉快的音樂.mp3
    > 背景音樂 不愉快的音樂 0.5
    > BGM None
```

> 如果不指定擴展名，則會按 `'mp3', 'ogg'` 的順序挑選存在文件的擴展名。
>
> <ruby>背景音樂<rt>BGM</rt></ruby>文件不存在的場合，背景音樂會停止，控制檯會出現警告。

### CG
`CG` 進入CG模式並立即使用指定的CG。

在CG模式下，CG佔據整個畫面，<ruby>立繪<rt>char</rt></ruby>不會被顯示，<ruby>背景圖片<rt>BG</rt></ruby>也是被擋住的。   
不指定參數會解除CG模式。   

+ 語法:
```
    > CG {文件名=None}
```
+ 樣例:
```
    > CG 極夜大戰
    > CG
```

> 如果不指定擴展名，則會按 `'webp', 'png', 'jpg'` 的順序挑選存在文件的擴展名。
>
> CG文件不存在的場合，控制檯會出現警告。
 
### EF | 特效

`EF` 改變畫面元素的<ruby>特效<rt>effect</rt></ruby>。

+ 語法:
```
    > EF {元素ID} {特效名}
```
+ 樣例:
```
    > EF bg 灰 
```
樣例使<ruby>背景圖片<rt>BG</rt></ruby>變得灰暗，需要參考 [進階/特效](../進階/特效.md) 。

### VIDEO | 視頻 | 视频

`VIDEO` 插入一個視頻，用於OP、ED之類的場合。

+ 語法:
```
    > VIDEO {影片名}
```
+ 樣例:
```
    > VIDEO OP.webm
    > 視頻 ED.mp4
```

### py/endpy

`py`/`endpy` 用於插入一段python3代碼。    
填在 `py` 和 `endpy` 之間的代碼會像真正的python代碼一樣執行。   

+ 樣例:
```
    > py
    import os
    os.system('shutdown -s')
    # 會把電腦關機，所以不要自己去試
    > endpy
```

### js/endjs

`js`/`endjs` 用於插入一段javascript代碼。   
填在 `js` 和 `endjs` 之間的代碼會像真正的javascript代碼一樣執行。   

+ 樣例:
```
    > js
    alert('快交錢纔能玩！')
    > endjs
```
<small>(要是寫成「用於插入JS」就會變得很H)</small>

### WRAP | 快速選項 | 快速选项

`WRAP` 設置產生跳轉的選項，可以簡單地控制劇本跳轉。

+ 語法:
```
    WRAP [{文字1},{跳轉文件1},{躍點1=None}] [{文字2},{跳轉文件2},{躍點2=None}] ... 
```
+ 樣例:
```
    > WRAP [接受治療,壞結局.play] [放棄治療,好結局.play]
    > 快速選項 [上,H劇情.play] [不上,正常劇情.play,不H]
```

對於這個例子:
```
    > WRAP [接受治療,壞結局.play] [放棄治療,好結局.play] [蘿莉治療,一章.play,原點]
```
會產生3個選項。   
第一個選項是「接受治療」，選擇後跳轉到劇本「壞結局.play」。   
第二個選項是「接受治療」，選擇後跳轉到劇本「好結局.play」。   
第二個選項是「蘿莉治療」，選擇後跳轉到劇本「一章.play」的躍點「原點」處。   

想要瞭解進階的流程控制的話，可以參考[進階/嵌入python.md](../進階/嵌入python.md)。

## python風格的寫法

如果你有編程經驗的話，可能會喜歡類似函數調用風格的寫法。

    > BG 家裏.png
    > BGM 打架的聲音.mp3

也可以寫成

    > BG('家裏.png')
    > BGM('打架的聲音.mp3')

這些命令都可以直接寫成python語句，參數和原本的寫法是一樣的。   
因爲直接調用了 `eval` 所以其實可以調用系統函數……不過好在每句都使用獨立的運行環境，不會互相干擾。

## 注意 

+ 命令都是大小寫敏感的<small>(當然對簡化字也是敏感的所以我定義了兩次別名……)</small>。

+ 應該可以支持所有主流文件格式<small>(因爲不是我寫的我也不知道)</small>。

+ 文件中的空行總是被忽略，在adv的表現上沒有任何影響。 

+ 多餘的空格會被忽略。   

        > BG   河上.png
        >BG 河上.png

    這兩種寫法都可以。

+ 在默認寫法中，你的文件名裏含有空格的話，得用引號把它包起來。

        > BG "教室 夜.png" 

    就像在命令列裏那樣。