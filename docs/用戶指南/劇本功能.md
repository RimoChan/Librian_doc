# 劇本功能

這個章節將會介紹如何使用控制劇本演出的功能。

## 功能表

+ BG   
    更換 <ruby>背景圖片<rt>BG</rt></ruby>
+ BGM    
    更換 <ruby>背景音樂<rt>BGM</rt></ruby>
+ CG   
    顯示或消除CG   
+ EF    
    爲畫面元素添加 <ruby>特效<rt>effect</rt></ruby>
+ VIDEO    
    播放一段 <ruby>視頻<rt>video</rt></ruby>
+ WRAP   
    快速控制選項和跳轉

## 詳細介紹

先說一下，用豎線分割的漢字是爲「看到英文就頭大的開發者」提供的中文寫法，效果和英文完全一樣。  

然後，語法欄目裏，大括號 `{}` 裏面的是參數的名字。如果名字後有等號 `=`，說明參數有默認值——也就是你不填這個參數就自動使用 `=` 後面的值。

### BG | 背景

`BG` 會把當前的<ruby>背景圖片<rt>BG</rt></ruby>換成你指定的文件。   
<small>(當然你得在圖片文件夾裏把圖片放好)</small>

+ 語法:
```
> BG {文件名} {淡入時間=1} {位置="0% 0%"} {漸變方法='_淡出'}
```
+ 樣例:
```
> BG 魔王城內
> 背景 染紅的街道.png
> BG 潘大爺神殿 1.5 "50% 50%"
```

> 漸變方法參數是由對應的CSS屬性指定的，在「前端/樣式/特效.css」中實現了幾個預置的漸變。
>
> 位置參數就是background-position。
>
> 如果不指定擴展名，則會按 webp, png, jpg 的順序挑選存在文件的擴展名。
>
> <ruby>背景圖片<rt>BG</rt></ruby>文件不存在的場合，背景會變成黑色，控制檯會出現警告。

### BGM | 背景音樂 | 背景音乐
`BGM` 會更換當前的<ruby>背景音樂<rt>BGM</rt></ruby>爲你指定的文件。

如果指定爲 `None`，<ruby>背景音樂<rt>BGM</rt></ruby>會消除，會有一點淡出時間。但總是沒有淡入。   

+ 語法:
```    
> BGM {文件名} {音量=1}
```
+ 樣例:
```
> BGM 愉快的音樂.mp3
> 背景音樂 不愉快的音樂 0.5
> BGM None
```

> 如果不指定擴展名，則會按 opus, mp3, ogg 的順序挑選存在文件的擴展名。
>
> <ruby>背景音樂<rt>BGM</rt></ruby>文件不存在的場合，背景音樂會停止，控制檯會出現警告。

### CG
`CG` 進入CG模式並立即使用指定的CG。

在CG模式下，CG佔據整個畫面，<ruby>立繪<rt>char</rt></ruby>和<ruby>背景圖片<rt>BG</rt></ruby>也會被擋住。   
不指定參數會解除CG。   

+ 語法:
```
> CG {文件名=None} {淡入時間=1} {漸變方法='_淡出'}
```
+ 樣例:
```
> CG 極夜大戰
> CG
```

> 漸變方法參數是由對應的CSS屬性指定的，在「前端/樣式/特效.css」中實現了幾個預置的漸變。
>
> 如果不指定擴展名，則會按 webp, png, jpg 的順序挑選存在文件的擴展名。
>
> CG文件不存在的場合，控制檯會出現警告。
 
### EF | 特效

`EF` 改變畫面元素的<ruby>特效<rt>effect</rt></ruby>。

+ 語法:
```
> EF {元素ID} {特效名}
```
+ 樣例:
```
> EF bg 灰 
```
樣例使<ruby>背景圖片<rt>BG</rt></ruby>變得灰暗，需要參考 [進階/特效](../進階/特效.md) 。

### VIDEO | 視頻 | 视频

`VIDEO` 插入一個視頻，用於OP、ED之類的場合。

+ 語法:
```
> VIDEO {影片名} {可以跳過=False}
```
+ 樣例:
```
> VIDEO OP.webm
> 視頻 ED.mp4 True
```

> 在指定 `可以跳過` 爲True後，可以點擊視頻來跳過。
>
> 不要在默認格式的語法中再顯式指定False，因爲是字符串，反而會變成True。  
> <small>(如果你不知道上面這句話在說什麼就當作它不存在吧……)</small>

### WRAP | 快速選項 | 快速选项

`WRAP` 設置產生跳轉的選項，可以簡單地控制劇本跳轉。

+ 語法:
```
WRAP [{文字1},{跳轉文件1},{躍點1=None}] [{文字2},{跳轉文件2},{躍點2=None}] ... 
```
+ 樣例:
```
> WRAP [接受治療,壞結局.liber] [放棄治療,好結局.liber]
> 快速選項 [上,H劇情.liber] [不上,正常劇情.liber,不H]
```

對於這個例子:
```
> WRAP [接受治療,壞結局.liber] [放棄治療,好結局.liber] [蘿莉治療,一章.liber,原點]
```
會產生3個選項。   
第一個選項是「接受治療」，選擇後跳轉到劇本「壞結局.liber」。   
第二個選項是「接受治療」，選擇後跳轉到劇本「好結局.liber」。   
第三個選項是「蘿莉治療」，選擇後跳轉到劇本「一章.liber」的躍點「原點」處。   

想要瞭解進階的流程控制的話，可以參考[進階/嵌入python.md](../進階/嵌入python.md)。

## python風格的寫法

如果你有編程經驗的話，可能會喜歡類似函數調用風格的寫法。

```
> BG 家裏.png
> BGM 打架的聲音.mp3
```

也可以寫成

```
> BG('家裏.png')
> BGM('打架的聲音.mp3')
```

這些命令都可以直接寫成python語句，參數和原本的寫法是一樣的。   
因爲直接調用了 `eval` 所以其實可以調用系統函數……不過好在每句都使用獨立的運行環境，不會互相干擾。

## 注意 

+ 命令都是大小寫敏感的<small>(當然對簡化字也是敏感的所以我定義了兩次別名……)</small>。

+ 應該可以支持所有主流文件格式<small>(因爲不是我寫的我也不知道)</small>。

+ 文件中的空行總是被忽略，在adv的表現上沒有任何影響。 

+ 多餘的空格會被忽略。   

        > BG   河上.png
        >BG 河上.png

    這兩種寫法都可以。

+ 在默認寫法中，你的文件名裏含有空格的話，得用引號把它包起來。

        > BG "教室 夜.png" 

    就像在命令列裏那樣。